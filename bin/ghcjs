#!/usr/bin/env sh
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

CABAL_ARGS=$(cd $DIR; cabal-cargs | sed 's/-package=\(jsaddle-warp\|tagsoup\|aeson\|lens-regex\|regex-tdfa\|tagsoup-lens\|warp\|wai\|wai-app-static\|wai-extra\|jsaddle-warp\|wreq\)//g' | sed 's/-isrc-ghc//g'|| exit 1)
OUT_ARGS="-isrc-ghcjs -outputdir=$DIR/../out"
FORWARD_ARGS=$@

cached-nix-shell $DIR/../default.nix -A shells.ghcjs --run "ghcjs $CABAL_ARGS $OUT_ARGS $FORWARD_ARGS"
